package guess.the.color.project.logic;

import guess.the.color.project.model.Complexity;
import guess.the.color.project.model.Game;

public class RoundManipulationServiceImpl implements RoundManipulationService {

	@Autowired
	private ColorServiceImpl colorService;

	public Game checkColor(Game game, String color, Complexity complexity) {
		String mainColor = game.getMainColor();

		int currentRound = game.getCurrentRound();
		int maxRounds = game.getRounds();
		int currentScore = game.getScore();
		int currentCircleCount = game.getNumOfStartingColors();

		if (mainColor.equals(color)) {
			if (currentRound % 3 == 0 && game.getComplexity() != Complexity.HARD) {
				currentCircleCount += 1;
			} else if (currentRound % 4 == 0 && game.getComplexity() == Complexity.HARD) {
				currentCircleCount += 1;
			}

			game.setNumOfStartingColors(currentCircleCount);

			if (currentRound == maxRounds) {
				game.setWon(true);
			} else {
				game.setCurrentRound(currentRound + 1);
				colorService.generateRoundColors(game);
			}

			if (game.getComplexity() == Complexity.EASY) {
				currentScore += 100;
			} else if (game.getComplexity() == Complexity.MEDIUM) {
				currentScore += 200;
			} else if (game.getComplexity() == Complexity.HARD) {
				currentScore += 300;
			}
		} else {
			currentScore -= 50;
		}

		game.setScore(currentScore);
		return game;
	}
}
